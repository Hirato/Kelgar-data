//TODO
//////
//possibility to run quest with different person with different values the same time
//make quest not restart infinetely with the same NPC


//get villagers food
r_script_signal "spawn" [
	r_signal "restartfoodquest"	
] 


r_script_signal "restartfoodquest" [

case (rnd 5) 0 [
		get_food_item = 0
		get_food_item_str = "apples"
		get_food_amount = (rnd 10 5) //apple
		value = 1
	] 1 [
		get_food_item = 14
		get_food_item_str = "bread loaves"
		get_food_amount = (rnd 2 4) //bread
		value = 3
	] 2 [
		get_food_item = 20
		get_food_item_str = "cooked pieces of meat"
		get_food_amount = (rnd 6 2) //cooked meat
		value = 8
	] 3 [
		get_food_item = 21
		get_food_item_str = "pears"
		get_food_amount = (rnd 10 8) //pear
		value = 1
	] 4 [
		get_food_item = 41
		get_food_item_str = "bilberries"
		get_food_amount = (rnd 18 8) //bilberries
		value = 1
	]
]




r_script_node "getfood" [result (format "Could you please get me %1 %2?" (get_food_amount) $get_food_item_str)
] [
	r_response "No, get it yourself." ""

	if ( >= (r_get_amount player ($get_food_item)) ($get_food_amount)) [	//has player already the food?

		r_response "Here you go." "foodreward" [
			r_remove player ($get_food_item) ($get_food_amount)
			r_additem talker ($get_food_item) ($get_food_amount)]] [

			r_response "Ok, I will get some." "" [
			r_journal_record "Get Food" (format "%1 wants me to get him %2 %3." (r_get_name talker)($get_food_amount) $get_food_item_str)]
]
]

r_script_node "foodreward" [result "Thank you for helping me. Take this in return."] [
	r_response "Thank you, but I dont want a reward." "foodthankyou" 

	r_response "Farewell." "" [
			//variables for rewards		
			like = (- (r_get_relationship talker player) 50)
			
			if (> $like 7) [//if he likes the player because of sth. else a lot
			like = 8]
			
			without_bonus = (* (get_food_amount) (value))
			reward = (+ (without_bonus) (like))

			//rewards
			if (< $like 4) [
			r_mod_relationship talker player 1]
			r_additem player 16 $reward
			r_remove talker 16 $reward
			r_givexp player 5
			//echo (format "DEBUG: like: %1; value: %2; money per item: %3" $like $value $money_per_item)
			r_journal_record "Get Food" (format "I gave %1 %2 %3. I got %4 copper coins in return." (r_get_name talker)($get_food_amount) $get_food_item_str $reward)
			r_signal "restartfoodquest"]
]

r_script_node "foodthankyou" [result "Thank you very much!"] [
	r_response "No problem. I'm glad I could help you." "" [
		if (< $like 5) [ //maximal like/bonus is 8 copper!
		r_mod_relationship talker player 4] //he is very happy about the gift
		r_givexp player 5
		r_journal_record "Get Food" (format "I gifted %1 %2 %3." (r_get_name talker)($get_food_amount) $get_food_item_str)
		r_signal "restartfoodquest"]

	r_response "No, seriously. Give me the reward." "foodreward"
]
